function allAI(){let e=!0,t=document.querySelector(".ai-explanation"),n=document.querySelector(".ai-explanation-none").innerHTML,o=document.querySelector(".post-ai"),i=document.querySelectorAll(".ai-btn-item"),r="",a="",c=600,s=0,l=0,u=[],d=0,m=!1,h=new AbortController,f=h.signal;const p="填入chatGPT的apiKey",y="https://blog.shineyu.cn/",g="IN5UottZ9fQ3YI9tkxwu",T=n=>{if(e)if(T.start||(T.start=n),d=n-T.start,d>=20){if(T.start=n,s<a-1){let e=r.charAt(s+1),n=/[,.，。!?！？]/.test(e)?150:20;t.firstElementChild&&t.removeChild(t.firstElementChild),t.innerHTML+=e;let o=document.createElement("div");o.className="ai-cursor",t.appendChild(o),s++,150===n&&(document.querySelector(".ai-explanation .ai-cursor").style.opacity="0"),s===a-1&&(S.disconnect(),t.removeChild(t.firstElementChild)),u[0]=setTimeout((()=>{requestAnimationFrame(T)}),n)}}else requestAnimationFrame(T)},S=new IntersectionObserver((n=>{let o=n[0].isIntersecting;e=o,e&&(c=0===s?200:20,u[1]=setTimeout((()=>{l&&(s=0,l=0),0===s&&(t.innerHTML=r.charAt(0)),requestAnimationFrame(T)}),c))}),{threshold:0});function b(n=!0){s=0,l=1,u.length&&u.forEach((e=>{e&&clearTimeout(e)})),e=!1,d=0,t.innerHTML=n?"生成中. . .":"请等待. . .",m||h.abort(),r="",a="",S.disconnect()}function A(e,t=!0){b(t),r=e,a=r.length,S.observe(o)}function E(){A("我是文章辅助AI: Shine-AI，点击右上角的ShineGPT按钮，让我生成本文简介、推荐相关文章等。")}function q(){A(n)}function v(){b(),u[2]=setTimeout((()=>{t.innerHTML=function(){let e="推荐文章：<br />",t=document.querySelectorAll(".relatedPosts-list-item");if(!t||0===t.length)return e="很抱歉，无法找到类似的文章，你也可以看看本站最近更新的文章：<br />",t=document.querySelectorAll(".thumbnail"),e+='<div class="ai-recommend">',t.forEach(((t,n)=>{e+=`<div class="ai-recommend-item"><span>推荐${n+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${t.href}')" title="${t.title}" data-pjax-state="">${t.title}</a></div>`})),e+="</div>",e;return e+='<div class="ai-recommend">',t.forEach(((t,n)=>{e+=`<div class="ai-recommend-item"><span>推荐${n+1}：</span><a href="javascript:;" onclick="pjax.loadUrl('${t.href}')" title="${t.title}" data-pjax-state="">${t.title}</a></div>`})),e+="</div>",e}()}),300)}function w(){b(),u[2]=setTimeout((()=>{t.innerHTML=document.querySelector(".ai-explanation-series").innerHTML}),300)}function x(){let e=document.querySelector(".ai-btn-box");"none"==e.style.display?e.style.display="flex":e.style.display="none"}async function I(){if(function(e=3e3){let t=Date.now()-localStorage.getItem("aiTime");return t<e&&(btf.snackbarShow(3-parseInt(t/1e3)+"后才能再次点击真AI简介"),!0)}())return;localStorage.setItem("aiTime",Date.now()),b();const e=function(e,t=!0){let n;n=t?`文章的各级标题：${$(e)}。文章内容的截取：${o=C(e),i=o.substring(0,500),r=o.substring(o.length-200),a=(o.length-300)/2,c=o.substring(a,a+300),i+c+r}`:`${C(e)}`;var o,i,r,a,c;return n}(document.querySelector("#article-container"));console.log(e);const t=await async function(e,t=!0){m=!1,h=new AbortController,f=h.signal;let n="";if(t){try{if(n=await fetch("https://summary.tianli0.top/",{signal:f,method:"POST",headers:{"Content-Type":"application/json",Referer:y},body:JSON.stringify({content:e,key:g})}),429===n.status&&A("请求过于频繁，请稍后再请求AI。"),!n.ok)throw new Error("Response not ok")}catch(e){console.error("Error occurred:",e),A("Shine-AI请求tianliGPT出错了，请稍后再试。")}const t=(await n.json()).summary;return m=!0,t}{const t=`你是一个摘要生成工具，你需要解释我发送给你的内容，不要换行，不要超过200字，只需要介绍文章的内容，不需要提出建议和缺少的东西。请用中文回答，文章内容为：${e}`,o="https://api.openai.com/v1/chat/completions";try{if(n=await fetch(o,{signal:f,method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"user",content:t}]})}),429===n.status&&A("请求过于频繁，请稍后再请求AI。"),!n.ok)throw new Error("Response not ok")}catch(e){console.error("Error occurred:",e),A("Shine-AI请求chatGPT出错了，请稍后再试。")}const i=(await n.json()).choices[0].message.content;return m=!0,i}}(e,true);console.log(t),A(t)}function C(e){const t=["highlight","Copyright-Notice","post-ai","post-series","mini-sandbox"];let n="";for(let o of e.childNodes)if(o.nodeType===Node.TEXT_NODE)n+=o.textContent.trim();else if(o.nodeType===Node.ELEMENT_NODE){let e=!1;for(let n of o.classList)if(t.includes(n)){e=!0;break}if(!e){n+=C(o)}}return n.replace(/\s+/g,"")}function $(e){const t=e.querySelectorAll("h1, h2, h3, h4"),n=[];for(let e=0;e<t.length;e++){const o=t[e],i=o.textContent.trim();n.push(i);const r=$(o);n.push(...r)}return n.join(";")}!function(){t=document.querySelector(".ai-explanation"),n=document.querySelector(".ai-explanation-none").innerHTML,o=document.querySelector(".post-ai"),i=document.querySelectorAll(".ai-btn-item"),ai_tag=document.querySelector(".ai-tag");const e=[E,q,v,I,w];i.forEach(((t,n)=>{t.addEventListener("click",e[n])})),q(),ai_tag.addEventListener("click",x)}()}allAI();